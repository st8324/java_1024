<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.kh.spring.dao.MemberDAO">
  	<insert id="insertMember">
  		insert into member(me_id, me_pw, me_email, me_birthday)
  		values(#{m.me_id},#{m.me_pw},#{m.me_email},#{m.me_birthday})
  	</insert>
  	<insert id="insertMemberOK">
  		insert into member_ok(mo_me_id, mo_num, mo_valid_time)
  			values(#{mok.mo_me_id},#{mok.mo_num},
  				date_add(#{mok.mo_valid_time},interval 1 hour))
  	</insert>
  	<select id="selectMemberOK" resultType="kr.kh.spring.vo.MemberOKVO">
  		select * from member_ok 
  			where mo_me_id = #{mok.mo_me_id} 
  				and mo_num = #{mok.mo_num}
  				and mo_valid_time >= now()
  	</select>
  	<delete id="deleteMemberOK">
  		delete from member_ok 
  			where mo_me_id = #{mok.mo_me_id} and mo_num = #{mok.mo_num}
  	</delete>
  	<update id="updateAuthority">
  		update member
  			set
  				me_authority = #{me_authority}
  			where
  				me_id = #{me_id}
  	</update>
  	<select id="selectMemberById" resultType="kr.kh.spring.vo.MemberVO">
  		select * from member where me_id = #{me_id}
  	</select>
  	<update id="updateSession">
  		update
  			member
  		set
  			me_session_id = #{member.me_session_id},
  			me_session_limit = #{member.me_session_limit}
  		where
  			me_id = #{member.me_id}
  	</update>
  	<select id="selectMemberBySession" resultType="kr.kh.spring.vo.MemberVO">
  		select
  			* 
  		from
  			member
  		where
  			me_session_id = #{me_session_id} and me_session_limit > now()
  	</select>
  	<resultMap type="kr.kh.spring.vo.A" id="A">
  		<id property="a_num" column="a_num"/>
  		<result property="a_table" column="a_table"/>
  		<result property="a_target_num" column="a_target_num"/>
  		<collection property="b" ofType="kr.kh.spring.vo.B" column="a_target_num" select="selectBListByA"></collection>
  		<collection property="c" ofType="kr.kh.spring.vo.C" column="a_target_num" select="selectCListByA"></collection>
  	</resultMap>
  	<select id="selectAList" resultMap="A">
  		select * from A
  	</select>
  	<select id="selectBListByA" resultType="kr.kh.spring.vo.B">
  		select * from B where b_num = #{a_target_num}
  	</select>
  	<select id="selectCListByA" resultType="kr.kh.spring.vo.C">
  		select * from C where c_num = #{a_target_num}
  	</select>
</mapper>
